{% extends "issues/base.html" %}
{% load gravatar %}

{% block title %}Projects{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/project_list.css" />
{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL}}js/urlify.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/project_list.js"></script>
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script>
    $(document).ready(function() {

    });
    $(function() {
        $( '.tabs' ).tabs({ collapsible: true });
    });
    </script>
{% endblock %}

{% block content %}
    {{ block.super }}
    <section id="projects" class='left'>
        <h3 class="header">Projects
        <button type="button" class="right" id="new_project_button">New Project</button>
        </h3>

                {% include 'issues/project_new.html' %}
        <div class="project-list">
        {% for project in object_list %}
            <div id='{{ project|slugify }}' class="project">
                <div id="tabs-{{ project.pk }}" class="tabs">
                  <ul>
                    <li><a href="#tabs-{{ project.pk }}-inprogress" class="tab">In Progress</a></li>                            
                    <li><a href="#tabs-{{ project.pk }}-assigned" class="tab">Assigned</a></li>
                    <li><a href="#tabs-{{ project.pk }}-unassigned" class="tab">Unassigned</a></li>
                    <li><a href="#tabs-{{ project.pk }}-completed" class="tab">Completed</a></li>
                    <li><a href="#tabs-{{ project.pk }}-deleted" class="tab">Deleted</a></li>
                    <span class="header-in-tabs right">{{ project.as_a }}</a><span class='small'> ({{ project.issue_set.all.count }})</span></span>
                  </ul>
                  <div id="tabs-{{ project.pk }}-assigned" class="tab-content">
                      {% for issue in project.assigned_issues %}
                          <div class="issue clear">{{ issue }}
                              <img src= "{{ issue.assigned_to.email|gravatar }}" class="gravatar_small right">
                              <a class="right" href="{% url user_profile_view user_id=issue.assigned_to.pk %}">{{ issue.assigned_to.first_name }}</a>
                          </div>
                      {% endfor %}
                  </div>
                  <div id="tabs-{{ project.pk }}-inprogress" class="tab-content">
                      {% for issue in project.in_progress_issues %}
                          <div class="issue clear">{{ issue }}
                              <img src= "{{ issue.assigned_to.email|gravatar }}" class="gravatar_small right">
                              <a class="right" href="{% url user_profile_view user_id=issue.assigned_to.pk %}">{{ issue.assigned_to.first_name }}</a>
                          </div>
                      {% endfor %}
                  </div>
                  <div id="tabs-{{ project.pk }}-unassigned" class="tab-content">
                      {% for issue in project.unassigned_issues %}
                          <div class="issue clear">{{ issue }}</div>
                      {% endfor %}
                  </div>
                  <div id="tabs-{{ project.pk }}-completed" class="tab-content">
                      {% for issue in project.recently_completed_issues %}
                          <div class="issue clear">{{ issue }}
                              {% if issue.assigned_to %}
                                  <img src= "{{ issue.assigned_to.email|gravatar }}" class="gravatar_small right">
                                  <a class="right" href="{% url user_profile_view user_id=issue.assigned_to.pk %}">{{ issue.assigned_to.first_name }}&nbsp;</a> 
                              {% endif %}
                         </div>
                      {% endfor %}
                  </div>
                  <div id="tabs-{{ project.pk }}-deleted" class="tab-content">
                      {% for issue in project.recently_deleted_issues %}
                          <div class="issue clear">{{ issue }}</div>
                      {% endfor %}
                  </div>
                </div>
            </div>
        {% endfor %}
        </div>
    </section>
    
    <section id="users" class='left'>
        <h3 class="header">
            Users
            <span class="small right"><a href="">New User</a></span>
        </h3>
        {% for user in users %}
        <div class="project">
            <div id="tabs-{{ user.pk }}" class="tabs">
                <ul>
                    <span class="right header-in-tabs"> 
                       <img src= "{{ issue.assigned_to.email|gravatar }}" class="gravatar_small"> <a href="{% url user_profile_view user_id=user.pk %}">{{ user.first_name }}</a>
                    </span>
                    <li><a href="#tabs-{{ user.pk }}-inprogress" class="tab">In Progress</a></li>
                    <li><a href="#tabs-{{ user.pk }}-assigned" class="tab">Assigned</a></li>
                    <li><a href="#tabs-{{ user.pk }}-completed" class="tab">Completed</a></li>
                </ul>
                <div id="tabs-{{ user.pk }}-inprogress" class="tab-content">
                    {% for issue in user.inprogress_issues %}
                        <div
                        {% if forloop.counter|divisibleby:2 %}
                            class="issue even"
                        {% else %}
                            class="issue odd"
                        {% endif %}
                        >
                        <div class="left">
                            {{ issue }}
                        </div>
                        <div class="right">
                            {{ issue.project.as_a }}</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div id="tabs-{{ user.pk }}-assigned" class="tab-content">
                    {% for issue in user.assigned_issues %}
                        <div
                        {% if forloop.counter|divisibleby:2 %}
                            class="issue even"
                        {% else %}
                            class="issue odd"
                        {% endif %}
                        >
                        <div class="left">
                            {{ issue }}
                        </div>
                        <div class="right">
                            {{ issue.project.as_a }}</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div id="tabs-{{ user.pk }}-completed" class="tab-content">
                    {% for issue in user.completed_issues|slice:":10" %}
                        <div
                        {% if forloop.counter|divisibleby:2 %}
                            class="issue even"
                        {% else %}
                            class="issue odd"
                        {% endif %}
                        >
                        <div class="left">
                            {{ issue }}
                        </div>
                        <div class="right">
                            {{ issue.project.as_a }}</a>
                        </div>
                    </div>
                    {% endfor %}                         
                </div>
            </div>
        </div>
        {% endfor %}
    </section>
    

{% endblock %}
